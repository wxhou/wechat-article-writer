---
name: wechat-article-writer
description: 公众号文章创作与发布。完整流程：自动场景识别 → 获取内容 → 质量检查 → 写作/翻译 → AI配图建议 → 格式优化 → 发布。使用场景：(1) 用户给 X/网页链接要写成公众号文章 (2) 给英文文章要求翻译并发布 (3) 给标题要求用 article-writer 创作 (4) 直接要求走完整流程不经过草稿
---

# 公众号文章创作 skill

## 核心特性

1. **自动场景识别** - 根据输入自动判断场景类型
2. **质量检查** - 错别字检测、可读性评分
3. **AI配图建议** - 自动分析内容推荐配图位置
4. **格式优化** - 一键美化排版
5. **错误处理** - 常见问题及解决方案

## 触发条件（自动识别）

当用户要求创作公众号文章时，根据输入类型自动判断：

| 输入类型 | 识别特征 | 处理方式 |
|---------|---------|---------|
| X/网页链接 | 包含 x.com、twitter.com、http | 场景1：获取内容 → 写作 → 配图 → 格式优化 → 发布 |
| 英文文章 | 纯英文、English标记 | 场景2：翻译 → 写作 → 配图 → 格式优化 → 发布 |
| 仅有标题 | 无链接、纯中文标题 | 场景3：article-writer 多轮调研 → 写作 → 配图 → 格式优化 → 发布 |
| 直接要求发布 | "直接发布"、"走完整流程" | 场景4：跳过草稿，直接走完整流程 |

## 完整流程

```
自动识别 → 获取内容 → 质量检查 → 写作/翻译 → AI配图建议 → 格式优化 → 发布
```

### Step 0: 自动场景识别

根据输入自动选择场景，无需用户手动选择。

### Step 1: 获取内容

**X 链接**: 使用 `baoyu-url-to-markdown` 或 `baoyu-danger-x-to-markdown`

**英文文章**: 读取原文，进行信达雅的翻译

**仅有标题**: 使用 `article-writer` 进行多轮信息检索
```bash
cd "/Users/wxhou/Documents/obsidian-note/微信公众号"
content init 文章标题 --workspace wechat
# 使用 /specify → /topic → /research 进行多轮调研
# 收集足够素材后再 /write
```

### Step 2: 质量检查（新增）

在写作前/后进行检查：

1. **错别字检测**: 使用工具检查常见错别字
2. **可读性评分**: 检查句子长度、段落长度
3. **敏感词检测**: 检查是否包含敏感词
4. **标题检查**: 确保标题有吸引力

### Step 3: 写作

使用 `article-writer` 或直接 Claude 写作（参考 CLAUDE.md）：
- 公众号: 深度技术文章，2000-4000字，配图精美
- 使用中文标题和中文标点
- 段落适中，避免长篇大块文字
- 关键信息使用引用块强调

### Step 4: AI 配图建议（新增）

使用 `baoyu-image-gen` 或 `baoyu-article-illustrator`

**自动分析**:
- 阅读文章内容
- 识别需要配图的场景（数据展示、对比、场景描述等）
- 推荐配图风格和位置

**备用方案**（当 baoyu-image-gen 失败时）:
```bash
# 使用 ModelScope 异步 API
python3 ~/.claude/skills/baoyu-image-gen/scripts/modelscope_fallback.py "prompt" output.png
```

### Step 5: 格式优化

使用 `baoyu-markdown-to-html` 转换后，执行手动优化：

#### 5.1 主题选择
- `default`: 经典主题，传统排版
- `grace`: 优雅主题，文字阴影，圆角卡片
- `simple`: 简洁主题，现代极简风

#### 5.2 手动优化项目

| 项目 | 优化方式 |
|-----|---------|
| 标题样式 | 二级标题使用彩色背景（#0F4C81） |
| 引用块 | `>` 强调核心观点，深蓝色文字 |
| 分隔线 | `---` 区分章节 |
| 列表样式 | 优化缩进，使用 `•` 标记 |
| 字体大小 | 正文 16px，行高 1.75 |
| 段落间距 | margin: 1.5em 调整 |
| 关键加粗 | 深蓝色强调重点 |

#### 5.3 美化检查清单

- [ ] 首段是否有吸引力
- [ ] 关键信息是否突出
- [ ] 配图位置是否合理
- [ ] 段落长度是否适中（每段不超过3行）
- [ ] 是否有足够的留白
- [ ] 字体是否统一

### Step 6: 发布

使用 `baoyu-post-to-wechat` 发布：
```bash
npx -y bun ~/.claude/skills/baoyu-post-to-wechat/scripts/wechat-api.ts article.html --cover cover.png --author "博主"
```

## 错误处理

### 常见问题及解决方案

| 问题 | 原因 | 解决方案 |
|-----|------|---------|
| 获取链接失败 | 网络问题/内容需要登录 | 使用浏览器方式或手动复制内容 |
| 图片生成失败 | API 配额用完/key 无效 | 使用备用方案：Python modelscope_fallback.py |
| 图片上传失败 | 路径错误/格式不支持 | 检查图片路径，转换为 PNG/JPG |
| API 白名单错误 | IP 不在白名单 | 添加当前 IP 到微信后台白名单 |
| 格式显示异常 | CSS 冲突 | 使用内联样式主题 |
| 内容被截断 | 字数超限 | 拆分文章或精简内容 |
| 浏览器未关闭 | MCP 工具未自动关闭 | 使用 MCP close_page 或关闭 profile 窗口 |

**关闭浏览器页面**:
```bash
# 使用 MCP 关闭指定页面 (推荐)
mcp__chrome-devtools__close_page --pageId <页面ID>
```

查看页面列表:
```bash
mcp__chrome-devtools__list_pages
```

## 项目目录

- 文章项目: `/Users/wxhou/Documents/obsidian-note/微信公众号/`
- 附件图片: `attachments/`
- 写作风格: 见 CLAUDE.md

## 检查清单

### 自动化
- [ ] 自动识别输入类型
- [ ] 自动选择处理流程

### 内容
- [ ] 质量检查通过
- [ ] 错别字已修正
- [ ] 可读性良好

### 配图
- [ ] 确定配图位置
- [ ] 生成配图
- [ ] 配图与内容相关

### 格式
- [ ] 标题样式美观
- [ ] 引用块突出重点
- [ ] 章节分隔清晰
- [ ] 字体大小合适
- [ ] 段落长度适中

### 发布
- [ ] 封面图已上传
- [ ] 发布到草稿箱
- [ ] 预览检查
